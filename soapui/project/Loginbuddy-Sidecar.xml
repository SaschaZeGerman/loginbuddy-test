<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="173f4f4f-1fdf-4da1-9331-836e89f113cc" activeEnvironment="Default" name="D-Loginbuddy-Sidecar" resourceRoot="" soapui-version="5.7.2" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:testSuite id="bf26e54f-f23f-477c-80da-dd4f2a4c2e03" name="Sidecar-Default"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="37e79b64-ee55-413b-860b-52b5a0b774a1" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Initialize-default" searchProperties="true"><con:settings/><con:testStep type="httprequest" name="initialize" id="f1b8b0bb-f3a2-4f0c-b845-6c7c6f5b55e4"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:201"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: no empty parameter"><con:configuration><scriptText>// check that prompt is included
assert messageExchange.responseHeaders["Location"][0].contains("prompt=login%20consent")

// check that login_hint is not included
assert messageExchange.responseHeaders["Location"][0].contains("login_hint") == false</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: contains domain"><con:configuration><scriptText>// check for domain after templating should have been appplied
assert messageExchange.responseHeaders["Location"][0].startsWith("https://demoserver.loginbuddy.net:8443")

// check for scope from template, not from default value
assert messageExchange.responseHeaders["Location"][0].contains("server_scope")</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value>${#Project#provider_test}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>${#Project#state}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>nonce</con:name><con:value>anoncevalue</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>prompt</con:name><con:value>login consent</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="initialize-http" id="66c2b4c7-852b-41b6-a97f-907bb59a000c"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize-http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host_http}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:201"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: no empty parameter"><con:configuration><scriptText>// check that prompt is included
assert messageExchange.responseHeaders["Location"][0].contains("prompt")

// check that login_hint is not included
assert messageExchange.responseHeaders["Location"][0].contains("login_hint") == false</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value>${#Project#provider_test}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>${#Project#state}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>nonce</con:name><con:value>anoncevalue</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>prompt</con:name><con:value>none</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="initialize-minimum" id="25154ef1-039e-4057-b0ed-361e7b50c0a2"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize-minimum" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:201"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value>${#Project#provider_test}</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="initialize-self-issued" id="2cf37a6e-6c7a-4086-8b7d-14ebf167004d"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize-self-issued" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:201"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: no empty parameter"><con:configuration><scriptText>// check that prompt is included
assert messageExchange.responseHeaders["Location"][0].contains("prompt")

// check that login_hint is not included
assert messageExchange.responseHeaders["Location"][0].contains("login_hint") == false</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value>self-issued</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>${#Project#state}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>nonce</con:name><con:value>anoncevalue</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>prompt</con:name><con:value>none</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="initialize-no-provider" id="99f9f74b-82e1-423c-969f-75e71f7672c2"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize-no-provider" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:400"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: no empty parameter"><con:configuration><scriptText>// check that error_description is included
assert messageExchange.responseHeaders["Location"][0].contains("error_description")</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value/><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>${#Project#state}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>nonce</con:name><con:value>anoncevalue</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>prompt</con:name><con:value>none</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="initialize-unknown-provider" id="e4f50d26-7325-4490-96e6-14f6d4359fa3"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize-unknown-provider" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:400"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: no empty parameter"><con:configuration><scriptText>// check that error_description is included
assert messageExchange.responseHeaders["Location"][0].contains("error_description")</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value>unknown</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>${#Project#state}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>nonce</con:name><con:value>anoncevalue</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>prompt</con:name><con:value>none</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="initialize-error" id="9bc0a4bb-2bb0-4747-834d-c09bd0f20a15"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize-error" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host_loginbuddy}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:400"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value>${#Project#provider_test}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>${#Project#state}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>nonce</con:name><con:value>anoncevalue</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="aac1bae0-3c8d-4e9d-9b44-42f5d286ac66" name="Sidecar-Dynamic-Registration"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="dd31c969-d652-4c53-96b6-d3253370cdb1" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="initialize-dynamic-registration" searchProperties="true"><con:settings/><con:testStep type="httprequest" name="Initialize-UseDynamic-fail" id="efcb2a0f-5dee-42b8-8d15-5e3a6db08747"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="a62cea81-ccce-4627-9997-8ed9710f78ee" name="Initialize-UseDynamic-fail" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Trying dynamic but telling the server not to accept that</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="11162d97-1929-4008-8d5f-0f10eb3109ae" name="status: 400"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter required="false" disableUrlEncoding="false"><con:name>issuer</con:name><con:value>${#Project#issuer_dynamic_provider}</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>accept_dynamic_provider</con:name><con:value>false</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="Initialize-UseDynamic" id="15fe1beb-26d0-4511-81b3-8b6b3a59b4cd"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="a62cea81-ccce-4627-9997-8ed9710f78ee" name="Initialize-UseDynamic" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Trying dynamic but telling the server not to accept that</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="a84fd343-adb0-4129-90d8-bb4ebd8e9934" name="status: 201"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d3a4667d-d16f-4760-acb5-acb31f4d0333" name="contains: authorize"><con:configuration><scriptText>// check that prompt is included
assert messageExchange.responseHeaders["Location"][0].contains("/authorize")</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter required="false" disableUrlEncoding="false"><con:name>issuer</con:name><con:value>${#Project#issuer_dynamic_provider}</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter required="false" disableUrlEncoding="false"><con:name>accept_dynamic_provider</con:name><con:value>true</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="65a81c0f-7066-4581-bb6c-11421e4e5a3c" name="CompleteFlow"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="950bd4bd-bfca-4987-958b-14e5ca853619" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="success" searchProperties="true"><con:settings/><con:testStep type="httprequest" name="initialize" id="8f45717f-e4b6-4bd4-8ae0-c7f3c8c54ac8"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="initialize" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_initialize}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:201"><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: no empty parameter"><con:configuration><scriptText>// check that prompt is included
assert messageExchange.responseHeaders["Location"][0].contains("prompt=login%20consent")

// check that login_hint is not included
assert messageExchange.responseHeaders["Location"][0].contains("login_hint") == false</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: contains domain"><con:configuration><scriptText>// check for domain after templating should have been appplied
assert messageExchange.responseHeaders["Location"][0].startsWith("https://demoserver.loginbuddy.net:8443")

// check for scope from template, not from default value
assert messageExchange.responseHeaders["Location"][0].contains("server_scope")</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>provider</con:name><con:value>${#Project#provider_test}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>${#Project#state}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>nonce</con:name><con:value>anoncevalue</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>prompt</con:name><con:value>login consent</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>obfuscate_token</con:name><con:value>true</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="groovy" name="setProviderEndpoint" id="53dfc831-ef56-4db7-9652-06c02159952c"><con:description>Set the endpoint for the next test step</con:description><con:settings/><con:config><script>//Find the 'Location' header of the response
  def location =
  testRunner.testCase.testSteps["initialize"].testRequest.response.responseHeaders["Location"][0]

  // Write the 'location' into the 'endpoint' of the testStep 'callProvider'
  def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
  groovyUtils.setPropertyValue("provider-callFakeProvider",
  "Endpoint", location.toString())</script></con:config></con:testStep><con:testStep type="httprequest" name="provider-callFakeProvider" id="b977849b-de63-4a25-a192-28d5a50d1c35"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="be121e2d-1636-4a5d-ba1b-44ef31a40190" name="provider-callFakeProvider" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Calls the providers authorization endpoint and receives a login page</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:encoding xsi:nil="true"/><con:endpoint><![CDATA[https://demoserver.loginbuddy.net:8443/authorize?client_id=loginbuddy_demoId&response_type=code&scope=server_scope%20openid%20email%20profile&nonce=anoncevalue&redirect_uri=https%3A%2F%2Flocal.loginbuddy.net%2Fcallback&code_challenge=Owvz916Xqt5EAIvHV0CKFrv2YI2WVCOvK8h-Vj0ksG0&code_challenge_method=S256&prompt=login%20consent&state=c852d244-1088-4201-b7c8-eb8de3f66722]]></con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="1ad74da4-00c8-49ad-a962-6cbbdae08127" name="status=200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="27d5881d-f6b6-4fd2-b89b-9898cde2c318" name="check for 'x-frame-options'"><con:configuration><scriptText>assert messageExchange.responseHeaders["X-Frame-Options"] != null</scriptText></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:config></con:testStep><con:testStep type="transfer" name="provider-getState-Username" id="79460bec-fde0-4bbe-99a4-775462de1999"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>state</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>provider-callFakeProvider</con:sourceStep><con:sourcePath>//input[@name='session']/@value</con:sourcePath><con:targetType>session</con:targetType><con:targetStep>provider-provideEmailAddress</con:targetStep><con:type>XPATH</con:type><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>action</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>provider-callFakeProvider</con:sourceStep><con:sourcePath>//input[@name='action']/@value</con:sourcePath><con:targetType>action</con:targetType><con:targetStep>provider-provideEmailAddress</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="provider-provideEmailAddress" id="234855a2-2d5b-4d5c-ae7e-927bc4e77ae0"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="71049774-abb4-455a-a78a-93f8b9736e24" name="provider-provideEmailAddress" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Inserting
  the users email address to be send to the login-endpoint of the provider</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding xsi:nil="true"/><con:endpoint>${#Project#host_fake_server}/login</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="ae795b15-6bbb-4dfb-ad1e-af6d33edfdd0" name="statue=200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>email</con:name><con:value>${#Project#email}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>session</con:name><con:value>a2f4be1f-f494-458b-8ffa-a39b5e8cede5</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>action</con:name><con:value>login</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="transfer" name="provider-getState-Password" id="cd4d9507-1b61-4d2c-bc04-6b54a8782162"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>state</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>provider-provideEmailAddress</con:sourceStep><con:sourcePath>//input[@name='session']/@value</con:sourcePath><con:targetType>session</con:targetType><con:targetStep>provider-providePassword</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" disabled="false" entitize="false" ignoreEmpty="false" transferChildNodes="false" transferToAll="false" useXQuery="false"><con:name>action</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>provider-provideEmailAddress</con:sourceStep><con:sourcePath>//input[@name='action']/@value</con:sourcePath><con:targetType>action</con:targetType><con:targetStep>provider-providePassword</con:targetStep><con:targetPath xsi:nil="true"/><con:type>XPATH</con:type><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="provider-providePassword" id="63fc64fb-ac07-4948-8373-284eebc3cda5"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="e05f9780-7ac5-41be-a84b-fb2425d8b4cd" name="provider-providePassword" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Inserting
  the users password to be send to the authenticate-endpoint of the provider</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting></con:settings><con:endpoint>${#Project#host_fake_server}/authenticate</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="26cf303b-1eb4-484c-a132-9ef38be17d3e" name="status=200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>password</con:name><con:value>${#Project#password}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>session</con:name><con:value>a2f4be1f-f494-458b-8ffa-a39b5e8cede5</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>action</con:name><con:value>authenticate</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="transfer" name="provider-getState-Grant" id="8302b3b7-9b45-408a-a690-73c4e1ce4712"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>state</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>provider-providePassword</con:sourceStep><con:sourcePath>//input[@name='session']/@value</con:sourcePath><con:targetType>session</con:targetType><con:targetStep>provider-grantAccess</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="provider-grantAccess" id="442860f6-231b-4623-be8e-613859f1fbac"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="1c1997d7-7a13-416c-a6cd-fdc2b294865c" name="provider-grantAccess" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:description>Providing
  the users grant to be send to the consent-endpoint of the provider</con:description><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host_fake_server}/consent</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="5ab02bdb-ebc1-40a6-a242-e361e7a4e0f5" name="status=200"><con:configuration><codes>302</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>action</con:name><con:value>grant</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>session</con:name><con:value>a2f4be1f-f494-458b-8ffa-a39b5e8cede5</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="groovy" name="loginbuddy-extractLocation" id="104ab139-e560-46cf-b5a7-50e9e7811ba3"><con:description>Extract the state </con:description><con:settings/><con:config><script>//Takes one of the elements of the response Header
def location = testRunner.testCase.testSteps["provider-grantAccess"].testRequest.response.responseHeaders["Location"][0]

def code = location =~ /code=([^&amp;]+)/;
def state = location =~ /state=([^&amp;]+)/;

if (!code) {
  throw new RuntimeException("No code returned!");
}

if (!state) {
  throw new RuntimeException("No state returned!");
}

def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )

groovyUtils.setPropertyValue("callback", "code", code[0][1])
groovyUtils.setPropertyValue("callback", "state", state[0][1])</script></con:config></con:testStep><con:testStep type="httprequest" name="callback" id="4d541b06-d974-47e0-82e2-f3bde8b92889"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="1ebb34f2-9952-4eab-8bb6-85112b832b50" name="callback" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">false</con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_callback}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="dea7893e-6b43-435c-868a-b1fb20dc63dd" name="status:200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: content-type is set"><con:configuration><scriptText>// check that content-type is set
assert messageExchange.responseHeaders["Content-Type"][0].contains("application/json")</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="d2653be6-1680-4593-a6ee-b05a08ec6287" name="check: state is set as header"><con:configuration><scriptText>// check that content-type is set
assert messageExchange.responseHeaders["X-State"][0]</scriptText></con:configuration></con:assertion><con:assertion type="JsonPath RegEx Match" id="4f7ae679-747b-411d-8a75-20e20597f5fd" name="access_token=starts with lb. (obfuscated)"><con:configuration><path>$.access_token</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments><regEx>^lb[.].+</regEx></con:configuration></con:assertion><con:assertion type="JsonPath RegEx Match" id="4f7ae679-747b-411d-8a75-20e20597f5fd" name="refresh_token=starts with lb. (obfuscated)"><con:configuration><path>$.refresh_token</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments><regEx>^lb[.].+</regEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>code</con:name><con:value>f414f6cd-9043-414d-9571-31bdfb785788</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>state</con:name><con:value>c852d244-1088-4201-b7c8-eb8de3f66722</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="transfer" name="TokenResponse" id="52e13bcf-6599-45cb-b8b5-58179bc345a3"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>refresh_token</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>callback</con:sourceStep><con:sourcePath>$.refresh_token</con:sourcePath><con:targetType>refresh_token</con:targetType><con:targetStep>refresh_token</con:targetStep><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="httprequest" name="refresh_token" id="401b9aa1-942a-441a-885d-ce6eccbd0040"><con:settings/><con:config method="POST" xsi:type="con:HttpRequest" id="14f52da2-7f3f-43d1-9f35-4d5c531a0455" name="refresh_token" postQueryString="true" mediaType="application/x-www-form-urlencoded" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_token}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="513952a5-c36a-4446-80ea-f54956af287b" name="status=200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath RegEx Match" id="8fa153b8-dd22-40e0-b4d1-3705732c3f54" name="access_token is encrypted"><con:configuration><path>$.access_token</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments><regEx>^lb[.].+</regEx></con:configuration></con:assertion><con:assertion type="JsonPath RegEx Match" id="e7773f2c-d978-462e-8453-d0741c62ec06" name="refresh-token is encrypted"><con:configuration><path>$.refresh_token</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments><regEx>^lb[.].+</regEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>refresh_token</con:name><con:value>lb.Bzj9ZZ4mG4tug3RM5XG0Fv7MFtxw1W9zd0DuEtQ9X-sMdxQmW4-1ZBQk-287u_cohBIak21-t4FXLtjJzf1o0CILqkjusDxlAUf3VRC8lJ8=</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>grant_type</con:name><con:value>refresh_token</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>provider</con:name><con:value>${#Project#provider_test}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>scope</con:name><con:value>any scope</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite id="aaefd615-7663-4a16-a470-d69cd9a29459" name="Health"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="ad7622b6-fc72-40bf-bd67-bda7272d6fa2" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Checks" searchProperties="true"><con:settings/><con:testStep type="httprequest" name="Liveness" id="5ea3b3e6-45aa-4557-a869-c3621d70dde0"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="fb3e9da3-db56-400d-a5c4-b81d6d8da471" name="Liveness" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_status_liveness}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="32d9b0ac-f37b-43a3-890e-9f5e99ee86e1" name="status=200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple Contains" id="3e92b29d-907e-44e6-8e01-b1490f603b9d" name="contains=OK"><con:configuration><token>OK</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:config></con:testStep><con:testStep type="httprequest" name="Health" id="e724d45f-3fa5-48c5-a7ae-9f3a9df8c959"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="fb3e9da3-db56-400d-a5c4-b81d6d8da471" name="Health" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#host}${#Project#path_status_health}</con:endpoint><con:request/><con:assertion type="Valid HTTP Status Codes" id="32d9b0ac-f37b-43a3-890e-9f5e99ee86e1" name="status=200"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple Contains" id="3e92b29d-907e-44e6-8e01-b1490f603b9d" name="contains=OK"><con:configuration><token>OK</token><ignoreCase>false</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:properties><con:property><con:name>host</con:name><con:value>https://loginbuddy-sidecar:444</con:value></con:property><con:property><con:name>host_http</con:name><con:value>http://loginbuddy-sidecar:8044</con:value></con:property><con:property><con:name>host_sidecar_client</con:name><con:value>http://local.loginbuddy.net:8999</con:value></con:property><con:property><con:name>host_fake_Server</con:name><con:value>https://demoserver.loginbuddy.net:8443</con:value></con:property><con:property><con:name>host_loginbuddy</con:name><con:value>https://local.loginbuddy.net:444</con:value></con:property><con:property><con:name>path_initialize</con:name><con:value>/sidecar/initialize</con:value></con:property><con:property><con:name>path_callback</con:name><con:value>/sidecar/callback</con:value></con:property><con:property><con:name>path_sidecar_client</con:name><con:value>/example/sidecar/client</con:value></con:property><con:property><con:name>provider_test</con:name><con:value>server_loginbuddy</con:value></con:property><con:property><con:name>issuer_dynamic_provider</con:name><con:value>https://loginbuddy-demoserver:8443</con:value></con:property><con:property><con:name>issuer_discovery</con:name><con:value>https://demoserver.loginbuddy.net:8443/.well-known/openid-configuration</con:value></con:property><con:property><con:name>state</con:name><con:value>soapuiFakeState</con:value></con:property><con:property><con:name>email</con:name><con:value>fake@emailaddress.com</con:value></con:property><con:property><con:name>password</con:name><con:value>fakePAssword</con:value></con:property><con:property><con:name>path_status_liveness</con:name><con:value>/status/liveness</con:value></con:property><con:property><con:name>path_status_health</con:name><con:value>/status/health</con:value></con:property><con:property><con:name>path_token</con:name><con:value>/sidecar/token</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>